#Move

Action Move Track t Container c MovePhase p
  require not in m.in null
  effect put m.in m
  effect put c Token Rand(0,5)
  effect delete p
  effect create UseTokensPhase


#UseTokens

Action SpendToken Marker m Container c UseTokensPhase p
  require not in m.in null #Can this sort of check be automated?
  require contains c Token
  effect put m.in m
  effect remove Token c 1 #How to best format this?

Action Transition Container c UseTokensPhase p
  require not contains c Token
  effect delete p
  effect create SpacePhase

Action StopAtRoom Container c Marker m UseTokensPhase p
  require in m Room
  effect remove Token c all


#Space

Action DrawAsset Container c Marker m SpacePhase p
  require contains c Asset
  require contains m.in GreenCell
  effect distribute c player Asset 1 rand
  effect delete p
  effect create MovePhase
  effect Players Current.Left

Action LoseAsset Marker m SpacePhase p Asset a
  require contains m.in RedCell
  effect delete a
  effect delete p
  effect create MovePhase
  effect Players Current.Left

Action EnterRoom Marker m SpacePhase p Container c
  require contains m.in RoomCell
  require contains c Question 15
  effect distribute c All Question 15 rand
  effect delete p
  effect create SelectPhase


#SelectRoom

Action SelectRoom SelectPhase p Container c ActiveRoomHolder a
  require not contains a Room
  effect takeput c a Room 1 rand
  effect delete p
  effect create RoomPhase

Action RejectRoom SelectPhase p Container c ActiveRoomHolder a Room r
  require in r a
  effect delete r
  effect takeput c a Room 1 rand

Action SelectRoom SelectPhase p ActiveRoomHolder a
  require contains a Room
  effect delete p
  effect create RoomPhase
  effect Players All


#StartTimer

Action StartTimer StartTimerPhase p
  effect set timer 120         #set timer for 2 minutes
  effect delete p
  effect create QuestionPhase


#Question

Action AskQuestion QuestionPhase p Container c Question q
  require timer > 0
  require owns player q
  effect put c q
  effect disown q

Action FinishQuestioning QuestionPhase p
  effect take Current Question all
  effect delete p
  effect create RoomPhase


#Room

Action SendAsset RoomPhase p MissionSlots m Asset a
  require owns player a
  require contains m Asset < 3      #m contains fewer than three Assets
  effect put m a

Action RecallAsset RoomPhase p MissionSlots m Asset a
  require in a m
  effect take m a

Action LockInAssets RoomPhase p
  effect delete p
  effect create ResolvePhase


#Resolve

Action Succeed ResolvePhase p ActiveRoomHolder a Room r MissionSlots m
  require in r a
  require rcontains m r.contains         #a recursive contains
  effect delete p
  effect create GetAntidotesPhase

Action Fail ResolvePhase p ActiveRoomHolder a Room r MissionSlots m
  require in r a
  require not rcontains m r.contains     #a recursive contains
  effect delete r
  effect delete a.contains     #Delete all assets in a
  effect delete p
  effect create RefillAssetsPhase


#GetAntidotes

Action DrawAntidote GetAntidotesPhase p Container c ActiveRoomHolder a Room r
  require in r a
  require contains r Object a'      #Here Object indicates "any type"
  effect delete a'
  effect put c Antidote Rand(0, 1)

Action FinishDrawing GetAntidotesPhase p ActiveRoomHolder a Room r
  require in r a
  require contains r Object = 0          #Room contains zero objects in it
  effect delete r
  effect delete p
  effect create MovePhase
  effect Players Former.Left


#RefillAssets

Action RefillAssets RefillAssetsPhase p Container c
  require owns player Asset < 3
  effect distribute c player Asset 1 rand

Action EndRefill RefillAssetsPhase p
  effect Players Former.Left
  effect delete p
  effect create MovePhase
